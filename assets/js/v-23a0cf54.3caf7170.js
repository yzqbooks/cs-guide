"use strict";(self.webpackChunkcs_guide=self.webpackChunkcs_guide||[]).push([[32002],{28359:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e=JSON.parse('{"key":"v-23a0cf54","path":"/java-tutor/server-config/nginx-config.html","title":"nginx使用","lang":"zh-CN","frontmatter":{"summary":"nginx使用 主分文件分片 https://blog.csdn.net/qq_41783562/article/details/106530017 注意要把 include conf.d/*.conf; 写在http{}内部 config.d/nav.conf config.d/static.conf config.d/zfile.conf 需要注意roo","head":[["meta",{"property":"og:url","content":"https://yzqdev.github.io/cs-guide/cs-guide/java-tutor/server-config/nginx-config.html"}],["meta",{"property":"og:site_name","content":"cs-guide"}],["meta",{"property":"og:title","content":"nginx使用"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-06-18T06:54:45.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:modified_time","content":"2022-06-18T06:54:45.000Z"}]]},"excerpt":"","headers":[],"git":{"createdTime":1649166358000,"updatedTime":1655535285000,"contributors":[{"name":"yzqdev","email":"yzqdev@outlook.com","commits":2}]},"readingTime":{"minutes":2.19,"words":658},"filePathRelative":"java-tutor/server-config/nginx-config.md","localizedDate":"2022年4月5日"}')},61893:(n,s,a)=>{a.r(s),a.d(s,{default:()=>h});var e=a(66252);const i=(0,e.uE)('<h1 id="nginx使用" tabindex="-1"><a class="header-anchor" href="#nginx使用" aria-hidden="true">#</a> nginx使用</h1><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>sudo apt<span class="token operator">-</span>get install nginx\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>',2),l=(0,e.Uk)("主分文件分片 "),t={href:"https://blog.csdn.net/qq_41783562/article/details/106530017",target:"_blank",rel:"noopener noreferrer"},c=(0,e.Uk)("https://blog.csdn.net/qq_41783562/article/details/106530017"),o=(0,e.uE)('<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl start nginx\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意要把 <code>include conf.d/*.conf;</code> 写在<code>http{}</code>内部</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\n<span class="token comment">#user  nobody;</span>\nworker_processes  <span class="token number">1</span><span class="token punctuation">;</span>\n\n<span class="token comment">#error_log  logs/error.log;</span>\n<span class="token comment">#error_log  logs/error.log  notice;</span>\n<span class="token comment">#error_log  logs/error.log  info;</span>\n\n<span class="token comment">#pid        logs/nginx.pid;</span>\nevents <span class="token punctuation">{</span>\n    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n\n\n\nhttp <span class="token punctuation">{</span>\n    include       mime.types<span class="token punctuation">;</span>\n    default_type  application/octet-stream<span class="token punctuation">;</span>\n\n    <span class="token comment">#log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>\n    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>\n    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>\n\n    <span class="token comment">#access_log  logs/access.log  main;</span>\n\n    sendfile        on<span class="token punctuation">;</span>\n    <span class="token comment">#tcp_nopush     on;</span>\n\n    <span class="token comment">#keepalive_timeout  0;</span>\n    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>\n\n    <span class="token comment">#gzip  on;</span>\n    include conf.d/*.conf<span class="token punctuation">;</span>\n \n    server <span class="token punctuation">{</span>\n        listen       <span class="token number">80</span><span class="token punctuation">;</span>\n        server_name  localhost<span class="token punctuation">;</span>\n\n        <span class="token comment">#charset koi8-r;</span>\n\n        <span class="token comment">#access_log  logs/host.access.log  main;</span>\n\n        location / <span class="token punctuation">{</span>\n            root   html<span class="token punctuation">;</span>\n            index  index.html index.htm<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">#error_page  404              /404.html;</span>\n\n        <span class="token comment"># redirect server error pages to the static page /50x.html</span>\n        <span class="token comment">#</span>\n        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>\n        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>\n            root   html<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span>\n        <span class="token comment">#</span>\n        <span class="token comment">#location ~ \\.php$ {</span>\n        <span class="token comment">#    proxy_pass   http://127.0.0.1;</span>\n        <span class="token comment">#}</span>\n\n        <span class="token comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span>\n        <span class="token comment">#</span>\n        <span class="token comment">#location ~ \\.php$ {</span>\n        <span class="token comment">#    root           html;</span>\n        <span class="token comment">#    fastcgi_pass   127.0.0.1:9000;</span>\n        <span class="token comment">#    fastcgi_index  index.php;</span>\n        <span class="token comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>\n        <span class="token comment">#    include        fastcgi_params;</span>\n        <span class="token comment">#}</span>\n\n        <span class="token comment"># deny access to .htaccess files, if Apache&#39;s document root</span>\n        <span class="token comment"># concurs with nginx&#39;s one</span>\n        <span class="token comment">#</span>\n        <span class="token comment">#location ~ /\\.ht {</span>\n        <span class="token comment">#    deny  all;</span>\n        <span class="token comment">#}</span>\n    <span class="token punctuation">}</span>\n\n\n    <span class="token comment"># another virtual host using mix of IP-, name-, and port-based configuration</span>\n    <span class="token comment">#</span>\n    <span class="token comment">#server {</span>\n    <span class="token comment">#    listen       8000;</span>\n    <span class="token comment">#    listen       somename:8080;</span>\n    <span class="token comment">#    server_name  somename  alias  another.alias;</span>\n\n    <span class="token comment">#    location / {</span>\n    <span class="token comment">#        root   html;</span>\n    <span class="token comment">#        index  index.html index.htm;</span>\n    <span class="token comment">#    }</span>\n    <span class="token comment">#}</span>\n\n\n    <span class="token comment"># HTTPS server</span>\n    <span class="token comment">#</span>\n    <span class="token comment">#server {</span>\n    <span class="token comment">#    listen       443 ssl;</span>\n    <span class="token comment">#    server_name  localhost;</span>\n\n    <span class="token comment">#    ssl_certificate      cert.pem;</span>\n    <span class="token comment">#    ssl_certificate_key  cert.key;</span>\n\n    <span class="token comment">#    ssl_session_cache    shared:SSL:1m;</span>\n    <span class="token comment">#    ssl_session_timeout  5m;</span>\n\n    <span class="token comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span>\n    <span class="token comment">#    ssl_prefer_server_ciphers  on;</span>\n\n    <span class="token comment">#    location / {</span>\n    <span class="token comment">#        root   html;</span>\n    <span class="token comment">#        index  index.html index.htm;</span>\n    <span class="token comment">#    }</span>\n    <span class="token comment">#}</span>\n\n<span class="token punctuation">}</span>\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>config.d/nav.conf</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\n   server<span class="token punctuation">{</span>\n    listen    <span class="token number">6800</span><span class="token punctuation">;</span>\n    server_name   www.yzqdev.top<span class="token punctuation">;</span>\n      location / <span class="token punctuation">{</span>\n            root   /opt/navurl/<span class="token punctuation">;</span>\n            index  index.html index.htm<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n   server<span class="token punctuation">{</span>\n    listen    <span class="token number">80</span><span class="token punctuation">;</span>\n    server_name   www.yzqdev.top<span class="token punctuation">;</span>\n       client_max_body_size 20m<span class="token punctuation">;</span>\n         location / <span class="token punctuation">{</span>\n           proxy_pass http://localhost:8090<span class="token punctuation">;</span>\n            \n            \n        <span class="token punctuation">}</span>\n         \n \n\n    <span class="token punctuation">}</span>\n\n server<span class="token punctuation">{</span>\n    listen    <span class="token number">2800</span><span class="token punctuation">;</span>\n    server_name   www.yzqdev.top<span class="token punctuation">;</span>\n      location /home/main/ <span class="token punctuation">{</span>\n           root   /opt/myblog<span class="token punctuation">;</span>\n           try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>\n           index  index.html index.htm<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n         location / <span class="token punctuation">{</span>\n            root   /opt/myblog<span class="token punctuation">;</span>\n            try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>\n            index  index.html index.htm<span class="token punctuation">;</span>\n\n\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>config.d/static.conf</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code> \n  server<span class="token punctuation">{</span>\n    listen    <span class="token number">2333</span><span class="token punctuation">;</span>\n    server_name   www.yzqdev.top<span class="token punctuation">;</span>\n     index  index.html<span class="token punctuation">;</span>\n    location /atools <span class="token punctuation">{</span>\n           root   /opt/atools/<span class="token punctuation">;</span>\n           try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>\n          \n <span class="token punctuation">}</span>\n    location / <span class="token punctuation">{</span>\n           root   /opt/atools/<span class="token punctuation">;</span>\n           try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>\n          \n <span class="token punctuation">}</span>\n  \n\n<span class="token punctuation">}</span>\nserver <span class="token punctuation">{</span>\n  listen  <span class="token number">8080</span><span class="token punctuation">;</span>\n  server_name www.yzqdev.top<span class="token punctuation">;</span>\n  location / <span class="token punctuation">{</span>\n    proxy_pass http://127.0.0.1:8080<span class="token punctuation">;</span>\n     proxy_redirect off<span class="token punctuation">;</span>\n        proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>\n        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>\n        proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>\n        root /usr/local/nginx/html<span class="token punctuation">;</span>\n        index index.html index.htm<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>config.d/zfile.conf</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>  server<span class="token punctuation">{</span>\n    listen    <span class="token number">9100</span><span class="token punctuation">;</span>\n    server_name   www.yzqdev.top<span class="token punctuation">;</span>\n location /admin <span class="token punctuation">{</span>\n           root   /opt/zfile-vue/<span class="token punctuation">;</span>\n           try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>\n           index  index.html index.htm<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n location /install <span class="token punctuation">{</span>\n           root   /opt/zfile-vue/<span class="token punctuation">;</span>\n           try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>\n           index  index.html index.htm<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      location / <span class="token punctuation">{</span>\n            root   /opt/zfile-vue/<span class="token punctuation">;</span>\n            try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>\n            index  index.html index.htm<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',9),p={class:"custom-container tip"},d=(0,e.uE)('<p class="custom-container-title">提示</p><p>需要注意root和alias区别<br> root与alias主要区别在于nginx如何解释location后面的uri，这会使两者分别以不同的方式将请求映射到服务器文件上。</p><p>alias是一个目录别名的定义（仅能用于location上下文），root则是最上层目录的定义。</p><p>直接通过例子来理解：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>location ^~ /123/abc/ <span class="token punctuation">{</span>\nroot /data/www<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当请求<code>http://blog.whsir.com/123/abc/logo.png</code>时，将会返回服务器上的<code>/data/www/123/abc/logo.png</code>文件，即<code>/data/www+/123/abc/</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>location ^~ /123/abc/ <span class="token punctuation">{</span>\n<span class="token builtin class-name">alias</span> /data/www<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n当请求<span class="token variable"><span class="token variable">`</span>http://blog.whsir.com/123/abc/logo.png<span class="token variable">`</span></span>时，将会返回服务器上的<span class="token variable"><span class="token variable">`</span>/data/www/logo.png<span class="token variable">`</span></span>文件，即/data/www\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参考：</p>',8),u={href:"http://nginx.org/en/docs/http/ngx_http_core_module.html#root",target:"_blank",rel:"noopener noreferrer"},r=(0,e.Uk)("http://nginx.org/en/docs/http/ngx_http_core_module.html#root"),v={href:"http://nginx.org/en/docs/http/ngx_http_core_module.html#alias",target:"_blank",rel:"noopener noreferrer"},m=(0,e.Uk)("http://nginx.org/en/docs/http/ngx_http_core_module.html#alias"),b=(0,e.uE)('<p>对于vuepress使用pages ,最终网址是类似 <code>yourname.github.io/cs-guide</code> 需要配置nginx如下</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\nserver<span class="token punctuation">{</span>\n    listen    <span class="token number">80</span><span class="token punctuation">;</span>\n    server_name   www.yzqdev.top<span class="token punctuation">;</span>\n      location /cs-guide <span class="token punctuation">{</span>\n\n            <span class="token builtin class-name">alias</span>   /opt/cs-guide/<span class="token punctuation">;</span>\n            index  index.html index.htm<span class="token punctuation">;</span>\n            try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      location / <span class="token punctuation">{</span>\n            root   /opt/cs-guide/<span class="token punctuation">;</span>\n            index  index.html index.htm<span class="token punctuation">;</span>\n            try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n    <span class="token punctuation">}</span>\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',2),k={},h=(0,a(83744).Z)(k,[["render",function(n,s){const a=(0,e.up)("ExternalLinkIcon");return(0,e.wg)(),(0,e.iD)("div",null,[i,(0,e._)("p",null,[l,(0,e._)("a",t,[c,(0,e.Wm)(a)])]),o,(0,e._)("div",p,[d,(0,e._)("p",null,[(0,e._)("a",u,[r,(0,e.Wm)(a)]),(0,e._)("a",v,[m,(0,e.Wm)(a)])])]),b])}]])}}]);