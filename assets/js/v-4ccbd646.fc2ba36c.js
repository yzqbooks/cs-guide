"use strict";(self.webpackChunkcs_guide=self.webpackChunkcs_guide||[]).push([[63109],{86182:(e,n,l)=>{l.r(n),l.d(n,{data:()=>i});const i=JSON.parse('{"key":"v-4ccbd646","path":"/linux-tutor/server/VPN.html","title":"VPN（Virtual Private Network）介绍","lang":"zh-CN","frontmatter":{"summary":"VPN（Virtual Private Network）介绍 VPN 介绍 VPN 分类有很多，这里主要讲 PPTPD 和 L2TPD、OpenVPN PPTPD 安装 查看是否已安装：; CentOS：rpm -qa | grep pptpd; Ubuntu：dpkg -l | grep pptpd; 先安装依赖包：; CentOS 6：sudo yum ","head":[["meta",{"property":"og:url","content":"https://yzqdev.github.io/cs-guide/cs-guide/linux-tutor/server/VPN.html"}],["meta",{"property":"og:site_name","content":"cs-guide"}],["meta",{"property":"og:title","content":"VPN（Virtual Private Network）介绍"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-05-27T01:37:35.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:modified_time","content":"2022-05-27T01:37:35.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"VPN 介绍","slug":"vpn-介绍","children":[]},{"level":2,"title":"PPTPD 安装","slug":"pptpd-安装","children":[]},{"level":2,"title":"PPTPD 服务配置","slug":"pptpd-服务配置","children":[]},{"level":2,"title":"L2TPD 安装","slug":"l2tpd-安装","children":[]},{"level":2,"title":"L2TPD 服务配置","slug":"l2tpd-服务配置","children":[]},{"level":2,"title":"OpenVPN 安装","slug":"openvpn-安装","children":[]},{"level":2,"title":"OpenVPN 服务配置","slug":"openvpn-服务配置","children":[{"level":3,"title":"禁用 selinux","slug":"禁用-selinux","children":[]},{"level":3,"title":"生成OpenVPN需要的服务器、客户端证书","slug":"生成openvpn需要的服务器、客户端证书","children":[]},{"level":3,"title":"设置OpenVPN服务端配置文件","slug":"设置openvpn服务端配置文件","children":[]},{"level":3,"title":"配置内核和防火墙，开启nat功能，启动服务","slug":"配置内核和防火墙-开启nat功能-启动服务","children":[]},{"level":3,"title":"启动openvpn并设置为开机启动","slug":"启动openvpn并设置为开机启动","children":[]},{"level":3,"title":"OpenVPN客户端配置","slug":"openvpn客户端配置","children":[]}]},{"level":2,"title":"VPN 资料","slug":"vpn-资料","children":[]}],"git":{"createdTime":1653615455000,"updatedTime":1653615455000,"contributors":[{"name":"yzqdev","email":"yzqdev@outlook.com","commits":1}]},"readingTime":{"minutes":10.05,"words":3014},"filePathRelative":"linux-tutor/server/VPN.md","localizedDate":"2022年5月27日"}')},66850:(e,n,l)=>{l.r(n),l.d(n,{default:()=>Z});var i=l(66252);const s=(0,i.uE)('<h1 id="vpn-virtual-private-network-介绍" tabindex="-1"><a class="header-anchor" href="#vpn-virtual-private-network-介绍" aria-hidden="true">#</a> VPN（Virtual Private Network）介绍</h1><h2 id="vpn-介绍" tabindex="-1"><a class="header-anchor" href="#vpn-介绍" aria-hidden="true">#</a> VPN 介绍</h2><p>VPN 分类有很多，这里主要讲 PPTPD 和 L2TPD、OpenVPN</p><h2 id="pptpd-安装" tabindex="-1"><a class="header-anchor" href="#pptpd-安装" aria-hidden="true">#</a> PPTPD 安装</h2><ul><li><p>查看是否已安装：</p></li><li><p>CentOS：<code>rpm -qa | grep pptpd</code></p></li><li><p>Ubuntu：<code>dpkg -l | grep pptpd</code></p></li><li><p>先安装依赖包：</p></li><li><p>CentOS 6：<code>sudo yum -y install ppp</code></p></li><li><p>Ubuntu：<code>sudo apt-get install -y ppp</code></p></li><li><p>安装：</p></li><li><p>CentOS 6：<code>sudo yum -y install pptpd</code></p></li><li><p>Ubuntu：<code>sudo apt-get install -y pptpd</code></p></li></ul><h2 id="pptpd-服务配置" tabindex="-1"><a class="header-anchor" href="#pptpd-服务配置" aria-hidden="true">#</a> PPTPD 服务配置</h2>',6),a=(0,i.uE)("<li>注意：PPTPD 默认端口是 1723，所以防火墙要取消对其限制，查看 1723 端口是否开启：<code>sudo netstat -apnl | grep 1723</code></li><li>编辑 PPTPD 配置文件介绍（记得先备份）：<code>sudo vim /etc/pptpd.conf</code></li><li>修改配置信息： <ul><li><code>option /etc/ppp/options.pptpd</code> #配置文件中有一行这样的参数，如果没有自己添加上去，正常默认是有的。同时也有可能是这样的一句话：<code>option /etc/ppp/pptpd-options</code>，具体你自己看下你的配置文件里面是什么内容。</li><li><code>logwtmp</code> #默认这个是没有被注释的，这里要进行注释</li><li><code>localip 172.31.0.1</code> #本机服务器的内网IP地址，建议你的内网IP一般不要用常见网段，默认这个被注释，取消注释</li><li><code>remoteip 192.168.0.10-200</code> #客户端的IP地址范围，默认这个被注释，取消注释</li></ul></li><li>编辑 PPP 配置文件介绍（记得先备份）：<code>sudo vim /etc/ppp/options.pptpd</code> 或是 <code>sudo vim /etc/ppp/pptpd-options</code></li><li>在文件尾巴添加如下配置信息（默认配置文件应该有，只是被注释了）： <ul><li><code>ms-dns 8.8.8.8</code> #配置DNS，如果是境外服务器最好改为google的，国内的看情况</li><li><code>ms-dns 8.8.4.4</code> #配置DNS，如果是境外服务器最好改为google的，国内的看情况</li></ul></li><li>开启系统转发（记得先备份）：<code>sudo vim /etc/sysctl.conf</code></li><li>修改配置信息该值改为 1： <ul><li><code>net.ipv4.ip_forward=1</code> # 默认是注释掉的，要取消注释，也有出现是没有注释，但是默认是0：<code>net.ipv4.ip_forward=0</code></li></ul></li><li>刷新配置：<code>sudo sysctl -p</code></li><li>设置 iptables 转发：</li><li>追加 iptables 规则：<code>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</code></li><li>设置默认启动使用该规则：<code>sudo vim /etc/rc.local</code><ul><li>在配置文件中添加：<code>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</code></li></ul></li><li>添加登录账号（记得先备份）：<code>sudo vim /etc/ppp/chap-secrets</code></li><li>在文件尾巴添加如下配置信息： <ul><li><code>mytest1 pptpd 123456 *</code> #该格式分别表示：登录名、登录协议、密码、该连接上的客户端用什么 IP（* 表示随机一个 IP）</li></ul></li><li>重启服务：<code>sudo service pptpd restart</code></li>",14),p=(0,i.Uk)("Windows 连接 VPN 方法："),t={href:"http://www.cnblogs.com/yuzeren48/p/4123879.html",target:"_blank",rel:"noopener noreferrer"},o=(0,i.Uk)("http://www.cnblogs.com/yuzeren48/p/4123879.html"),c=(0,i.uE)('<h2 id="l2tpd-安装" tabindex="-1"><a class="header-anchor" href="#l2tpd-安装" aria-hidden="true">#</a> L2TPD 安装</h2><ul><li><p>查看是否已安装：</p></li><li><p>CentOS：<code>rpm -qa | grep xl2tpd</code></p></li><li><p>Ubuntu：<code>dpkg -l | grep xl2tpd</code></p></li><li><p>安装：</p></li><li><p>CentOS 6：<code>XXXXXXXXXXXXXXXXXXXXXXXX</code></p></li><li><p>Ubuntu：<code>sudo apt-get install -y xl2tpd ppp openswan</code></p></li></ul><h2 id="l2tpd-服务配置" tabindex="-1"><a class="header-anchor" href="#l2tpd-服务配置" aria-hidden="true">#</a> L2TPD 服务配置</h2><ul><li>注意：L2TPD 默认端口是 1701，所以防火墙要取消对其限制，查看 1701 端口是否开启：<code>sudo netstat -apnl | grep 1701</code></li><li>编辑 Openswan 配置文件介绍（记得先备份）：<code>sudo vim /etc/ipsec.conf</code></li><li>left=172.31.201.255 #其中这里的IP地址改为本机的内网IP，文件中有两处，都进行修改</li><li>编辑 IPsec-based 配置文件介绍（记得先备份）：<code>sudo vim /etc/ipsec.secrets</code></li><li>172.31.201.255 %any: PSK&quot;adc123456&quot; #在文件最后一行补充：（格式是：本机内网IP，后面是配置密钥。密钥不配置也可以但是建议配上去）</li><li>编辑 L2TPD 配置文件介绍（记得先备份）：<code>sudo vim /etc/xl2tpd/xl2tpd.conf</code></li><li>修改配置信息：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ipsec saref <span class="token operator">=</span> <span class="token function">yes</span>           \nrequire chap <span class="token operator">=</span> <span class="token function">yes</span>   \nrefuse pap <span class="token operator">=</span> <span class="token function">yes</span>   \nrequire authentication <span class="token operator">=</span> <span class="token function">yes</span>  \nppp debug <span class="token operator">=</span> <span class="token function">yes</span>  \nlength bit <span class="token operator">=</span> <span class="token function">yes</span>\n<span class="token function">ip</span> range <span class="token operator">=</span> <span class="token number">192.168</span>.1.10-192.168.1.200              <span class="token comment">#这是客户端连接本机的IP端限制</span>\n<span class="token builtin class-name">local</span> <span class="token function">ip</span> <span class="token operator">=</span> <span class="token number">172.31</span>.201.255        <span class="token comment">#这是本机服务器端的内网 IP</span>\npppoptfile <span class="token operator">=</span> /etc/ppp/options.xl2tpd        <span class="token comment">#指定本机的 PPP 配置文件地址，如果你的 PPP 配置文件地址不是这里那就改下</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>编辑 PPP 配置文件介绍（记得先备份）：<code>sudo vim /etc/ppp/options.xl2tpd</code> (如果没有这个文件自己创建)</li><li>在文件尾巴添加如下配置信息：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>refuse-mschap-v2           \nrefuse-mschap           \nms-dns <span class="token number">8.8</span>.8.8           <span class="token comment">#配置DNS，如果是境外服务器最好改为google的，国内的看情况</span>\nms-dns <span class="token number">8.8</span>.4.4           <span class="token comment">#配置DNS，如果是境外服务器最好改为google的，国内的看情况</span>\nasyncmap <span class="token number">0</span>           \nauth           \nlock           \nhide-password           \n<span class="token builtin class-name">local</span>           \nname l2tpd           \nproxyarp           \nlcp-echo-interval <span class="token number">30</span>           \nlcp-echo-failure <span class="token number">4</span>           \nrefuse           \nrefuse           \nrefuse   \n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',7),r=(0,i.uE)("<li>在终端输入命令：sudo sh -c &#39;for each in /proc/sys/net/ipv4/conf/* do echo 0 &gt; $each/accept_redirects echo 0 &gt; $each/send_redirects done&#39;</li><li>开启系统转发（记得先备份）：<code>sudo vim /etc/sysctl.conf</code></li><li>修改配置信息： <ul><li>net.ipv4.ip_forward=1 #默认是注释掉的，要取消注释</li></ul></li><li>刷新配置：<code>sudo sysctl -p</code></li><li>设置 iptables 转发：</li><li>追加 iptables 规则：<code>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</code></li><li>设置默认启动使用该规则：<code>sudo vim /etc/rc.local</code><ul><li>在配置文件中添加：iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</li></ul></li><li>添加登录账号（记得先备份）：<code>sudo vim /etc/ppp/chap-secrets</code></li><li>在文件尾巴添加如下配置信息： <ul><li>mytest1 l2tpd 123456 * #该格式分别表示：登录名、登录协议、密码、该连接上的客户端用什么 IP（* 表示随机一个 IP）</li></ul></li><li>重启服务：<code>sudo service l2tpd restart</code></li>",10),d=(0,i.Uk)("Windows 连接 VPN 方法："),u={href:"http://www.cnblogs.com/yuzeren48/p/4123879.html",target:"_blank",rel:"noopener noreferrer"},v=(0,i.Uk)("http://www.cnblogs.com/yuzeren48/p/4123879.html"),m=(0,i._)("h2",{id:"openvpn-安装",tabindex:"-1"},[(0,i._)("a",{class:"header-anchor",href:"#openvpn-安装","aria-hidden":"true"},"#"),(0,i.Uk)(" OpenVPN 安装")],-1),h=(0,i._)("li",null,"主要软件版本信息：",-1),b=(0,i._)("li",null,"OpenVPN：2.3.11-1.el6",-1),k=(0,i._)("li",null,"EasyRsa：2.2.2-1.el6",-1),g=(0,i._)("li",null,[(0,i.Uk)("检查系统环境是否支持："),(0,i._)("code",null,"cat /dev/net/tun"),(0,i.Uk)("，如果出现："),(0,i._)("code",null,"cat: /dev/net/tun: File descriptor in bad state"),(0,i.Uk)("，则表示支持。如果现实的是："),(0,i._)("code",null,"cat: /dev/net/tun: No such device "),(0,i.Uk)("，则不支持")],-1),P=(0,i.Uk)("需要先安装 EPEL 源，具体可以看这篇文章："),f={href:"https://github.com/judasn/Linux-Tutorial/blob/master/centos-settings/CentOS-Extra-Packages.md",target:"_blank",rel:"noopener noreferrer"},y=(0,i.Uk)("CentOS 源设置"),_=(0,i._)("li",null,"安装：",-1),w=(0,i._)("li",null,[(0,i.Uk)("安装依赖包： "),(0,i._)("ul",null,[(0,i._)("li",null,[(0,i._)("code",null,"yum install -y gcc make rpm-build autoconf.noarch openssl openssl-devel lzo lzo-devel pam pam-devel automake pkgconfig")])])],-1),N=(0,i._)("li",null,[(0,i.Uk)("安装 OpenVPN： "),(0,i._)("ul",null,[(0,i._)("li",null,[(0,i._)("code",null,"yum install -y openvpn easy-rsa")])])],-1),x=(0,i.uE)('<h2 id="openvpn-服务配置" tabindex="-1"><a class="header-anchor" href="#openvpn-服务配置" aria-hidden="true">#</a> OpenVPN 服务配置</h2><h3 id="禁用-selinux" tabindex="-1"><a class="header-anchor" href="#禁用-selinux" aria-hidden="true">#</a> 禁用 selinux</h3><ul><li>编辑配置文件：<code>vim /etc/selinux/config</code></li><li>把 <code>SELINUX=enforcing</code> 改为 <code>SELINUX=disabled</code></li></ul><h3 id="生成openvpn需要的服务器、客户端证书" tabindex="-1"><a class="header-anchor" href="#生成openvpn需要的服务器、客户端证书" aria-hidden="true">#</a> 生成OpenVPN需要的服务器、客户端证书</h3><ul><li><p>使用 easy-rsa 的脚本产生证书</p></li><li><p>修改vars文件</p></li><li><p><code>cd /usr/share/easy-rsa/2.0</code>，后面关于证书的操作都是在这个目录下</p></li><li><p><code>vim vars</code></p><ul><li>需要修改的内容主要有下面这些信息（在文件 64 行）：注册信息，比如公司地址、公司名称、部门名称等。</li><li><code>export KEY_COUNTRY=&quot;CN&quot;</code></li><li><code>export KEY_PROVINCE=&quot;GuangDong&quot;</code></li><li><code>export KEY_CITY=&quot;GuangZhou&quot;</code></li><li><code>export KEY_ORG=&quot;YouMeekOrganization&quot;</code></li><li><code>export KEY_EMAIL=&quot;admin@youmeek.com&quot;</code></li><li><code>export KEY_OU=&quot;YouMeekOrganizationalUnit&quot;</code></li></ul></li><li><p>初始化环境变量</p></li><li><p><code>source vars</code></p></li><li><p>清除keys目录下所有与证书相关的文件，下面步骤生成的证书和密钥都在 /usr/share/easy-rsa/2.0/keys 目录里</p></li><li><p><code>./clean-all</code></p></li><li><p>生成根证书 ca.crt 和根密钥 ca.key（会有好几个提示，你都不需要输入什么内容，一路按回车即可，除非你懂原理）</p></li><li><p><code>./build-ca</code></p></li><li><p>为服务端生成证书和密钥（也会有好几个提示，你都不需要输入什么内容，一路按回车即可，直到提示需要输入y/n时，输入y再按回车继续走）</p></li><li><p>其中：server，这个名字别改，照着来，等下那些就可以直接使用。</p></li><li><p><code>./build-key-server server</code></p></li><li><p>每一个登陆的VPN客户端需要有一个证书，每个证书在同一时刻只能供一个客户端连接，下面语句是建立2份demo，你可以只输入第一个即可。</p></li><li><p>为客户端生成证书和密钥（一路按回车，直到提示需要输入y/n时，输入y再按回车，一共两次）</p></li><li><p>其中：client1，这个名字别改，照着来，等下那些就可以直接使用，除非你会。</p></li><li><p><code>./build-key client1</code></p></li><li><p><code>./build-key client2</code></p></li><li><p>创建迪菲·赫尔曼密钥，会在 keys 目录里面生成dh2048.pem文件（生成过程比较慢，在此期间不要去中断它，我这边花的时间是：2分钟）</p></li><li><p><code>./build-dh</code></p></li></ul><h3 id="设置openvpn服务端配置文件" tabindex="-1"><a class="header-anchor" href="#设置openvpn服务端配置文件" aria-hidden="true">#</a> 设置OpenVPN服务端配置文件</h3><ul><li><p>复制一份服务器端配置文件模板server.conf到/etc/openvpn/</p></li><li><p>其中，我这边现在的版本是：2.3.11，所以我这边是填这个，你的不一定就跟我一样，所以你先到 doc 目录下，看下你具体是哪个版本，改下下面这句命令即可。</p></li><li><p><code>cp /usr/share/doc/openvpn-2.3.11/sample/sample-config-files/server.conf /etc/openvpn/</code></p></li><li><p>编辑 server.conf，把下面的内容替换到已有的文件中，记得去掉后面的注释，我这样写只是为了方便解释对应的内容含义：</p><ul><li><code>vim /etc/openvpn/server.conf</code></li></ul></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>port <span class="token number">1194</span> <span class="token comment"># 端口一般我们不改</span>\nproto udp <span class="token comment"># 默认使用udp，如果使用HTTP Proxy，改成tcp，必须使用tcp协议，还需要注意的是：需要与客户端配置保持一致，等下客户端配置会说道</span>\ndev tun\nca /usr/share/easy-rsa/2.0/keys/ca.crt <span class="token comment"># 这一行默认值为：ca ca.crt</span>\ncert /usr/share/easy-rsa/2.0/keys/server.crt <span class="token comment"># 这一行默认值为：cert server.crt</span>\nkey /usr/share/easy-rsa/2.0/keys/server.key  <span class="token comment"># 这一行默认值为：key server.key</span>\ndh /usr/share/easy-rsa/2.0/keys/dh2048.pem  <span class="token comment"># 这一行默认值为：dh dh2048.pem</span>\nserver <span class="token number">10.192</span>.170.0 <span class="token number">255.255</span>.255.0  <span class="token comment"># 给客户的分配的局域网IP段，默认虚拟局域网网段，不要和实际的局域网冲突即可，这个10.192.170.0跟下面还有一个地方配置也有关联，需要注意</span>\nifconfig-pool-persist ipp.txt <span class="token comment"># 启用了ipp.txt作为客户端和virtual IP的对应表，以方便客户端重新连接可以获得同样的IP；</span>\nkeepalive <span class="token number">10</span> <span class="token number">120</span>\ncomp-lzo\npersist-key\npersist-tun\nstatus openvpn-status.log  <span class="token comment"># OpenVPN的状态日志，默认为/etc/openvpn/openvpn-status.log</span>\nlog openvpn.log <span class="token comment"># OpenVPN的运行日志，默认为/etc/openvpn/openvpn.log </span>\nlog-append openvpn.log\nverb <span class="token number">3</span>\n\npush <span class="token string">&quot;redirect-gateway def1 bypass-dhcp&quot;</span>\npush <span class="token string">&quot;dhcp-option DNS 8.8.8.8&quot;</span>\npush <span class="token string">&quot;dhcp-option DOMAIN-SEARCH ap-northeast-1.compute.internal&quot;</span>\npush <span class="token string">&quot;dhcp-option DOMAIN-SEARCH ec2.drawbrid.ge&quot;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置内核和防火墙-开启nat功能-启动服务" tabindex="-1"><a class="header-anchor" href="#配置内核和防火墙-开启nat功能-启动服务" aria-hidden="true">#</a> 配置内核和防火墙，开启nat功能，启动服务</h3><ul><li>开启路由转发功能 <ul><li><code>sed -i &#39;/net.ipv4.ip_forward/s/0/1/&#39; /etc/sysctl.conf</code></li><li>刷新配置：<code>sudo sysctl -p</code></li></ul></li></ul><p>辨别你的 VPS 是属于那种虚拟方式，主流有：Xen KVM OpenVZ，方法：</p><ul><li><p><code>sudo yum install -y virt-what</code>，virt-what是一个判断当前环境所使用的虚拟技术的脚本，常见的虚拟技术基本上都能正常识别出来</p><ul><li><code>sudo virt-what</code>，我这边 Vultr 输出的结果是：KVM</li></ul></li><li><p>配置防火墙</p><ul><li><code>iptables -A INPUT -p udp --dport 1194 -j ACCEPT</code></li><li><code>iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</code></li></ul></li><li><p>设置IP转发，若你的 VPS 虚拟方案是：Xen 或 KVM的请输入：（eth0要根据具体的网卡标示来，可以通过ifconfig查看），其中：10.192.170.0/16 表示客户端连接上去后从这个区间中分配给客户端的IP地址</p><ul><li><code>iptables -t nat -A POSTROUTING -s 10.192.170.0/16 -o eth0 -j MASQUERADE</code></li></ul></li><li><p>若你的 VPS 虚拟方案是：OpenVZ 的请输入：（45.32.90.22是你VPS的IP）</p><ul><li><code>iptables -t nat -A POSTROUTING -s 10.192.170.0/16 -j SNAT --to-source 45.32.90.22</code></li></ul></li><li><p>保存防火墙配置</p><ul><li><code>service iptables save</code></li><li><code>service iptables restart</code></li></ul></li></ul><h3 id="启动openvpn并设置为开机启动" tabindex="-1"><a class="header-anchor" href="#启动openvpn并设置为开机启动" aria-hidden="true">#</a> 启动openvpn并设置为开机启动</h3><ul><li><code>service openvpn start</code></li><li><code>chkconfig openvpn on</code></li></ul><h3 id="openvpn客户端配置" tabindex="-1"><a class="header-anchor" href="#openvpn客户端配置" aria-hidden="true">#</a> OpenVPN客户端配置</h3><p>下载 Windows 客户端： https://openvpn.net/index.php/download/community-downloads.html</p><p>Mac 用户下载这个 tunnelblick（该地址需要开穿越）： http://code.google.com/p/tunnelblick/</p><ul><li>从服务器上下载证书文件到本地： <ul><li><code>/usr/share/easy-rsa/2.0/keys/ca.crt</code></li><li><code>/usr/share/easy-rsa/2.0/keys/client1.crt</code></li><li><code>/usr/share/easy-rsa/2.0/keys/client1.key</code></li></ul></li></ul><p>到你本地的电脑上（window电脑在安装好OpenVPN软件后可以把如上证书拷贝到如下文件夹里：C:\\Program Files\\OpenVPN\\config ）</p><p>从服务器找到这个文件：/usr/share/doc/openvpn-2.3.11/sample/sample-windows/sample.ovpn，下载到本地电脑这个目录下：C:\\Program Files\\OpenVPN\\config 然后把这个文件改名字为：client1.ovpn 文件内如如下, 其他不用改只要把SERVER-IP 改成你服务器的 IP</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>client        <span class="token comment">#这个client不是自定义名称 不能更改</span>\ndev tun       <span class="token comment">#要与前面server.conf中的配置一致。</span>\nproto udp              <span class="token comment">#要与前面server.conf中的配置一致。</span>\nremote <span class="token number">45.32</span>.90.22 <span class="token number">1194</span>    <span class="token comment">#将45.32.90.22替换为你VPS的IP，端口也与前面的server.conf中配置一致。</span>\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nca ca.crt              <span class="token comment">#具体名称以刚下载的为准</span>\ncert client1.crt              <span class="token comment">#具体名称以刚下载的为准</span>\nkey client1.key              <span class="token comment">#具体名称以刚下载的为准</span>\ncomp-lzo\nverb <span class="token number">3</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>打开 OpenVPN 客户端，连接试试看。</li></ul><h2 id="vpn-资料" tabindex="-1"><a class="header-anchor" href="#vpn-资料" aria-hidden="true">#</a> VPN 资料</h2>',23),V={href:"http://www.jikexueyuan.com/course/1692_2.html?ss=1",target:"_blank",rel:"noopener noreferrer"},O=(0,i.Uk)("http://www.jikexueyuan.com/course/1692_2.html?ss=1"),U={href:"http://gnailuy.com/linux/2011/07/04/pptp-vpn/",target:"_blank",rel:"noopener noreferrer"},T=(0,i.Uk)("http://gnailuy.com/linux/2011/07/04/pptp-vpn/"),S={href:"http://www.centoscn.com/CentosServer/test/2014/1120/4153.html",target:"_blank",rel:"noopener noreferrer"},E=(0,i.Uk)("http://www.centoscn.com/CentosServer/test/2014/1120/4153.html"),I={href:"https://linux.cn/article-3706-1.html",target:"_blank",rel:"noopener noreferrer"},D=(0,i.Uk)("https://linux.cn/article-3706-1.html"),q={href:"http://www.bkjia.com/yjs/1041400.html",target:"_blank",rel:"noopener noreferrer"},A=(0,i.Uk)("http://www.bkjia.com/yjs/1041400.html"),X={href:"http://blog.liujason.com/1663.html",target:"_blank",rel:"noopener noreferrer"},C=(0,i.Uk)("http://blog.liujason.com/1663.html"),R={href:"http://shit.name/openvpn-on-centos/",target:"_blank",rel:"noopener noreferrer"},j=(0,i.Uk)("http://shit.name/openvpn-on-centos/"),z={href:"http://kunsland.github.io/blogs/2015/03/22/vps-openvpn/",target:"_blank",rel:"noopener noreferrer"},L=(0,i.Uk)("http://kunsland.github.io/blogs/2015/03/22/vps-openvpn/"),W={href:"http://neolee.com/web/centos-openvz-vps-configuration-openvpn/",target:"_blank",rel:"noopener noreferrer"},M=(0,i.Uk)("http://neolee.com/web/centos-openvz-vps-configuration-openvpn/"),K={href:"http://www.jikexueyuan.com/course/1692_4.html?ss=2",target:"_blank",rel:"noopener noreferrer"},Y=(0,i.Uk)("Freeradius 服务（用于账号认证管理的工具，可以扩展到VPN的账号管理）"),G={},Z=(0,l(83744).Z)(G,[["render",function(e,n){const l=(0,i.up)("ExternalLinkIcon");return(0,i.wg)(),(0,i.iD)("div",null,[s,(0,i._)("ul",null,[a,(0,i._)("li",null,[p,(0,i._)("a",t,[o,(0,i.Wm)(l)])])]),c,(0,i._)("ul",null,[r,(0,i._)("li",null,[d,(0,i._)("a",u,[v,(0,i.Wm)(l)])])]),m,(0,i._)("ul",null,[h,b,k,g,(0,i._)("li",null,[P,(0,i._)("a",f,[y,(0,i.Wm)(l)])]),_,w,N]),x,(0,i._)("ul",null,[(0,i._)("li",null,[(0,i._)("a",V,[O,(0,i.Wm)(l)])]),(0,i._)("li",null,[(0,i._)("a",U,[T,(0,i.Wm)(l)])]),(0,i._)("li",null,[(0,i._)("a",S,[E,(0,i.Wm)(l)])]),(0,i._)("li",null,[(0,i._)("a",I,[D,(0,i.Wm)(l)])]),(0,i._)("li",null,[(0,i._)("a",q,[A,(0,i.Wm)(l)])]),(0,i._)("li",null,[(0,i._)("a",X,[C,(0,i.Wm)(l)])]),(0,i._)("li",null,[(0,i._)("a",R,[j,(0,i.Wm)(l)])]),(0,i._)("li",null,[(0,i._)("a",z,[L,(0,i.Wm)(l)])]),(0,i._)("li",null,[(0,i._)("a",W,[M,(0,i.Wm)(l)])]),(0,i._)("li",null,[(0,i._)("a",K,[Y,(0,i.Wm)(l)])])])])}]])}}]);