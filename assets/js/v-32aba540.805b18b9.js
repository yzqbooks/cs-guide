"use strict";(self.webpackChunkcs_guide=self.webpackChunkcs_guide||[]).push([[53665],{21231:(e,i,l)=>{l.r(i),l.d(i,{data:()=>r});const r=JSON.parse('{"key":"v-32aba540","path":"/linux-tutor/server/Zookeeper-Install.html","title":"Zookeeper 安装","lang":"zh-CN","frontmatter":{"summary":"Zookeeper 安装 Docker 部署 Zookeeper 单个实例 官网仓库：; 单个实例：docker run -d --restart always --name one-zookeeper -p 2181:2181 -v /etc/localtime:/etc/localtime zookeeper:latest; 默认端口暴露是：This i","head":[["meta",{"property":"og:url","content":"https://yzqdev.github.io/cs-guide/cs-guide/linux-tutor/server/Zookeeper-Install.html"}],["meta",{"property":"og:site_name","content":"cs-guide"}],["meta",{"property":"og:title","content":"Zookeeper 安装"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-07-28T16:16:07.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:modified_time","content":"2022-07-28T16:16:07.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"Docker 部署 Zookeeper","slug":"docker-部署-zookeeper","children":[]},{"level":2,"title":"需要环境","slug":"需要环境","children":[]},{"level":2,"title":"下载安装","slug":"下载安装","children":[]},{"level":2,"title":"集群环境搭建","slug":"集群环境搭建","children":[{"level":3,"title":"确定机子环境","slug":"确定机子环境","children":[]},{"level":3,"title":"配置","slug":"配置","children":[]}]},{"level":2,"title":"Zookeeper 客户端工具","slug":"zookeeper-客户端工具","children":[]},{"level":2,"title":"资料","slug":"资料","children":[]}],"git":{"createdTime":1653615455000,"updatedTime":1659024967000,"contributors":[{"name":"yzqdev","email":"yzqdev@outlook.com","commits":2}]},"readingTime":{"minutes":4.15,"words":1246},"filePathRelative":"linux-tutor/server/Zookeeper-Install.md","localizedDate":"2022年5月27日"}')},14897:(e,i,l)=>{l.r(i),l.d(i,{default:()=>H});var r=l(66252);const o=(0,r.uE)('<h1 id="zookeeper-安装" tabindex="-1"><a class="header-anchor" href="#zookeeper-安装" aria-hidden="true">#</a> Zookeeper 安装</h1><h2 id="docker-部署-zookeeper" tabindex="-1"><a class="header-anchor" href="#docker-部署-zookeeper" aria-hidden="true">#</a> Docker 部署 Zookeeper</h2><h4 id="单个实例" tabindex="-1"><a class="header-anchor" href="#单个实例" aria-hidden="true">#</a> 单个实例</h4>',3),n=(0,r.Uk)("官网仓库："),d={href:"https://hub.docker.com/r/library/zookeeper/",target:"_blank",rel:"noopener noreferrer"},a=(0,r.Uk)("https://hub.docker.com/r/library/zookeeper/"),s=(0,r.uE)("<li>单个实例：<code>docker run -d --restart always --name one-zookeeper -p 2181:2181 -v /etc/localtime:/etc/localtime zookeeper:latest</code><ul><li>默认端口暴露是：<code>This image includes EXPOSE 2181 2888 3888 (the zookeeper client port, follower port, election port respectively)</code></li></ul></li><li>容器中的几个重要目录（有需要挂载的可以指定）： <ul><li><code>/data</code></li><li><code>/datalog</code></li><li><code>/conf</code></li></ul></li>",2),t=(0,r._)("h4",{id:"单机多个实例-集群",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#单机多个实例-集群","aria-hidden":"true"},"#"),(0,r.Uk)(" 单机多个实例（集群）")],-1),c=(0,r._)("li",null,[(0,r.Uk)("创建 docker compose 文件："),(0,r._)("code",null,"vim zookeeper.yml")],-1),u=(0,r.Uk)("下面内容来自官网仓库："),v={href:"https://hub.docker.com/r/library/zookeeper/",target:"_blank",rel:"noopener noreferrer"},m=(0,r.Uk)("https://hub.docker.com/r/library/zookeeper/"),p=(0,r.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>version: &#39;3.1&#39;\n\nservices:\n  zoo1:\n    image: zookeeper\n    restart: always\n    hostname: zoo1\n    ports:\n      - 2181:2181\n    environment:\n      ZOO_MY_ID: 1\n      ZOO_SERVERS: server.1=0.0.0.0:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888\n\n  zoo2:\n    image: zookeeper\n    restart: always\n    hostname: zoo2\n    ports:\n      - 2182:2181\n    environment:\n      ZOO_MY_ID: 2\n      ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=0.0.0.0:2888:3888 server.3=zoo3:2888:3888\n\n  zoo3:\n    image: zookeeper\n    restart: always\n    hostname: zoo3\n    ports:\n      - 2183:2181\n    environment:\n      ZOO_MY_ID: 3\n      ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=0.0.0.0:2888:3888\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动：<code>docker-compose -f zookeeper.yml -p zk_test up -d</code><ul><li>参数 -p zk_test 表示这个 compose project 的名字，等价于：<code>COMPOSE_PROJECT_NAME=zk_test docker-compose -f zookeeper.yml up -d</code></li><li>不指定项目名称，Docker-Compose 默认以当前文件目录名作为应用的项目名</li><li>报错是正常情况的。</li></ul></li><li>停止：<code>docker-compose -f zookeeper.yml -p zk_test stop</code></li></ul><h4 id="先安装-nc-再来校验-zookeeper-集群情况" tabindex="-1"><a class="header-anchor" href="#先安装-nc-再来校验-zookeeper-集群情况" aria-hidden="true">#</a> 先安装 nc 再来校验 zookeeper 集群情况</h4>',3),h=(0,r._)("li",null,"环境：CentOS 7.4",-1),k=(0,r.Uk)("官网下载："),b={href:"https://nmap.org/download.html",target:"_blank",rel:"noopener noreferrer"},g=(0,r.Uk)("https://nmap.org/download.html"),z=(0,r.Uk)("，找到 rpm 包"),_=(0,r._)("li",null,[(0,r.Uk)("当前时间（201803）最新版本下载："),(0,r._)("code",null,"wget https://nmap.org/dist/ncat-7.60-1.x86_64.rpm")],-1),x=(0,r._)("li",null,[(0,r.Uk)("安装："),(0,r._)("code",null,"sudo rpm -i ncat-7.60-1.x86_64.rpm")],-1),f=(0,r._)("li",null,[(0,r.Uk)("ln 下："),(0,r._)("code",null,"sudo ln -s /usr/bin/ncat /usr/bin/nc")],-1),y=(0,r._)("li",null,[(0,r.Uk)("检验："),(0,r._)("code",null,"nc --version")],-1),Z=(0,r.uE)('<h4 id="校验" tabindex="-1"><a class="header-anchor" href="#校验" aria-hidden="true">#</a> 校验</h4><ul><li>命令：<code>echo stat | nc 127.0.0.1 2181</code>，得到如下信息：</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Zookeeper version: 3.4.11-37e277162d567b55a07d1755f0b31c32e93c01a0, built on 11/01/2017 18:06 GMT\nClients:\n /172.21.0.1:58872[0](queued=0,recved=1,sent=0)\n\nLatency min/avg/max: 0/0/0\nReceived: 1\nSent: 0\nConnections: 1\nOutstanding: 0\nZxid: 0x100000000\nMode: follower\nNode count: 4\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>命令：<code>echo stat | nc 127.0.0.1 2182</code>，得到如下信息：</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Zookeeper version: 3.4.11-37e277162d567b55a07d1755f0b31c32e93c01a0, built on 11/01/2017 18:06 GMT\nClients:\n /172.21.0.1:36190[0](queued=0,recved=1,sent=0)\n\nLatency min/avg/max: 0/0/0\nReceived: 1\nSent: 0\nConnections: 1\nOutstanding: 0\nZxid: 0x500000000\nMode: follower\nNode count: 4\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>命令：<code>echo stat | nc 127.0.0.1 2183</code>，得到如下信息：</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Zookeeper version: 3.4.11-37e277162d567b55a07d1755f0b31c32e93c01a0, built on 11/01/2017 18:06 GMT\nClients:\n /172.21.0.1:33344[0](queued=0,recved=1,sent=0)\n\nLatency min/avg/max: 0/0/0\nReceived: 1\nSent: 0\nConnections: 1\nOutstanding: 0\nZxid: 0x500000000\nMode: leader\nNode count: 4\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="多机多个实例-集群" tabindex="-1"><a class="header-anchor" href="#多机多个实例-集群" aria-hidden="true">#</a> 多机多个实例（集群）</h4><ul><li>三台机子： <ul><li>内网 ip：<code>172.24.165.129</code>，外网 ip：<code>47.91.22.116</code></li><li>内网 ip：<code>172.24.165.130</code>，外网 ip：<code>47.91.22.124</code></li><li>内网 ip：<code>172.24.165.131</code>，外网 ip：<code>47.74.6.138</code></li></ul></li><li>修改三台机子 hostname： <ul><li>节点 1：<code>hostnamectl --static set-hostname youmeekhost1</code></li><li>节点 2：<code>hostnamectl --static set-hostname youmeekhost2</code></li><li>节点 3：<code>hostnamectl --static set-hostname youmeekhost3</code></li></ul></li><li>三台机子的 hosts 都修改为如下内容：<code>vim /etc/hosts</code></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>172.24.165.129 youmeekhost1\n172.24.165.130 youmeekhost2\n172.24.165.131 youmeekhost3\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>节点 1：</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -d \\\n-v /data/docker/zookeeper/data:/data \\\n-v /data/docker/zookeeper/log:/datalog \\\n-e ZOO_MY_ID=1 \\\n-e &quot;ZOO_SERVERS=server.1=youmeekhost1:2888:3888 server.2=youmeekhost2:2888:3888 server.3=youmeekhost3:2888:3888&quot; \\\n--name=zookeeper1 --net=host --restart=always zookeeper\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>节点 2：</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -d \\\n-v /data/docker/zookeeper/data:/data \\\n-v /data/docker/zookeeper/log:/datalog \\\n-e ZOO_MY_ID=2 \\\n-e &quot;ZOO_SERVERS=server.1=youmeekhost1:2888:3888 server.2=youmeekhost2:2888:3888 server.3=youmeekhost3:2888:3888&quot; \\\n--name=zookeeper2 --net=host --restart=always zookeeper\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>节点 3：</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -d \\\n-v /data/docker/zookeeper/data:/data \\\n-v /data/docker/zookeeper/log:/datalog \\\n-e ZOO_MY_ID=3 \\\n-e &quot;ZOO_SERVERS=server.1=youmeekhost1:2888:3888 server.2=youmeekhost2:2888:3888 server.3=youmeekhost3:2888:3888&quot; \\\n--name=zookeeper3 --net=host --restart=always zookeeper\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="需要环境" tabindex="-1"><a class="header-anchor" href="#需要环境" aria-hidden="true">#</a> 需要环境</h2><ul><li>JDK 安装</li></ul><h2 id="下载安装" tabindex="-1"><a class="header-anchor" href="#下载安装" aria-hidden="true">#</a> 下载安装</h2>',19),w=(0,r.Uk)("官网："),O={href:"https://zookeeper.apache.org/",target:"_blank",rel:"noopener noreferrer"},U=(0,r.Uk)("https://zookeeper.apache.org/"),S=(0,r._)("li",null,[(0,r.Uk)("此时（201702）最新稳定版本：Release "),(0,r._)("code",null,"3.4.9")],-1),E=(0,r.Uk)("官网下载："),R={href:"http://www.apache.org/dyn/closer.cgi/zookeeper/",target:"_blank",rel:"noopener noreferrer"},C=(0,r.Uk)("http://www.apache.org/dyn/closer.cgi/zookeeper/"),M=(0,r.uE)("<li>我这里以：<code>zookeeper-3.4.8.tar.gz</code> 为例</li><li>安装过程： <ul><li><code>mkdir -p /usr/program/zookeeper/data</code></li><li><code>cd /opt/setups</code></li><li><code>tar zxvf zookeeper-3.4.8.tar.gz</code></li><li><code>mv /opt/setups/zookeeper-3.4.8 /usr/program/zookeeper</code></li><li><code>cd /usr/program/zookeeper/zookeeper-3.4.8/conf</code></li><li><code>mv zoo_sample.cfg zoo.cfg</code></li><li><code>vim zoo.cfg</code></li></ul></li><li>将配置文件中的这个值： <ul><li>原值：<code>dataDir=/tmp/zookeeper</code></li><li>改为：<code>dataDir=/usr/program/zookeeper/data</code></li></ul></li><li>防火墙开放2181端口 <ul><li><code>iptables -A INPUT -p tcp -m tcp --dport 2181 -j ACCEPT</code></li><li><code>service iptables save</code></li><li><code>service iptables restart</code></li></ul></li><li>启动 zookeeper：<code>sh /usr/program/zookeeper/zookeeper-3.4.8/bin/zkServer.sh start</code></li><li>停止 zookeeper：<code>sh /usr/program/zookeeper/zookeeper-3.4.8/bin/zkServer.sh stop</code></li><li>查看 zookeeper 状态：<code>sh /usr/program/zookeeper/zookeeper-3.4.8/bin/zkServer.sh status</code><ul><li>如果是集群环境，下面几种角色 <ul><li>leader</li><li>follower</li></ul></li></ul></li>",7),D=(0,r.uE)('<h2 id="集群环境搭建" tabindex="-1"><a class="header-anchor" href="#集群环境搭建" aria-hidden="true">#</a> 集群环境搭建</h2><h3 id="确定机子环境" tabindex="-1"><a class="header-anchor" href="#确定机子环境" aria-hidden="true">#</a> 确定机子环境</h3><ul><li>集群环境最少节点是：3，且节点数必须是奇数，生产环境推荐是：5 个机子节点。</li><li>系统都是 CentOS 6</li><li>机子 1：192.168.1.121</li><li>机子 2：192.168.1.111</li><li>机子 3：192.168.1.112</li></ul><h3 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h3><ul><li>在三台机子上都做如上文的流程安装，再补充修改配置文件：<code>vim /usr/program/zookeeper/zookeeper-3.4.8/conf/zoo.cfg</code></li><li>三台机子都增加下面内容：</li></ul><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>server.1=192.168.1.121:2888:3888\nserver.2=192.168.1.111:2888:3888\nserver.3=192.168.1.112:2888:3888\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在 机子 1 增加一个该文件：<code>vim /usr/program/zookeeper/data/myid</code>，文件内容填写：<code>1</code></li><li>在 机子 2 增加一个该文件：<code>vim /usr/program/zookeeper/data/myid</code>，文件内容填写：<code>2</code></li><li>在 机子 3 增加一个该文件：<code>vim /usr/program/zookeeper/data/myid</code>，文件内容填写：<code>3</code></li><li>然后在三台机子上都启动 zookeeper：<code>sh /usr/program/zookeeper/zookeeper-3.4.8/bin/zkServer.sh start</code></li><li>分别查看三台机子的状态：<code>sh /usr/program/zookeeper/zookeeper-3.4.8/bin/zkServer.sh status</code>，应该会得到类似这样的结果：</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Using config: /usr/program/zookeeper/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: follower 或者 Mode: leader\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="zookeeper-客户端工具" tabindex="-1"><a class="header-anchor" href="#zookeeper-客户端工具" aria-hidden="true">#</a> Zookeeper 客户端工具</h2><h4 id="zooinspector" tabindex="-1"><a class="header-anchor" href="#zooinspector" aria-hidden="true">#</a> ZooInspector</h4>',10),I=(0,r.Uk)("下载地址："),T={href:"https://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip",target:"_blank",rel:"noopener noreferrer"},q=(0,r.Uk)("https://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip"),W=(0,r._)("li",null,"解压，双击 jar 文件，效果如下：",-1),j=(0,r._)("h4",{id:"zooweb",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#zooweb","aria-hidden":"true"},"#"),(0,r.Uk)(" zooweb")],-1),N=(0,r.Uk)("下载地址："),P={href:"https://github.com/zhuhongyu345/zooweb",target:"_blank",rel:"noopener noreferrer"},V=(0,r.Uk)("https://github.com/zhuhongyu345/zooweb"),Y=(0,r.Uk)("Spring Boot 的 Web 项目，直接："),L=(0,r._)("code",null,"java -jar zooweb-1.0.jar",-1),A=(0,r.Uk)(" 启动 web 服务，然后访问："),G={href:"http://127.0.0.1:9345",target:"_blank",rel:"noopener noreferrer"},J=(0,r.Uk)("http://127.0.0.1:9345"),B=(0,r._)("h2",{id:"资料",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#资料","aria-hidden":"true"},"#"),(0,r.Uk)(" 资料")],-1),K={href:"https://liwei.io/2017/07/19/zookeeper-cluster-in-docker/",target:"_blank",rel:"noopener noreferrer"},X=(0,r.Uk)("https://liwei.io/2017/07/19/zookeeper-cluster-in-docker/"),F={},H=(0,l(83744).Z)(F,[["render",function(e,i){const l=(0,r.up)("ExternalLinkIcon");return(0,r.wg)(),(0,r.iD)("div",null,[o,(0,r._)("ul",null,[(0,r._)("li",null,[n,(0,r._)("a",d,[a,(0,r.Wm)(l)])]),s]),t,(0,r._)("ul",null,[c,(0,r._)("li",null,[u,(0,r._)("a",v,[m,(0,r.Wm)(l)])])]),p,(0,r._)("ul",null,[h,(0,r._)("li",null,[k,(0,r._)("a",b,[g,(0,r.Wm)(l)]),z]),_,x,f,y]),Z,(0,r._)("ul",null,[(0,r._)("li",null,[w,(0,r._)("a",O,[U,(0,r.Wm)(l)])]),S,(0,r._)("li",null,[E,(0,r._)("a",R,[C,(0,r.Wm)(l)])]),M]),D,(0,r._)("ul",null,[(0,r._)("li",null,[I,(0,r._)("a",T,[q,(0,r.Wm)(l)])]),W]),j,(0,r._)("ul",null,[(0,r._)("li",null,[N,(0,r._)("a",P,[V,(0,r.Wm)(l)])]),(0,r._)("li",null,[Y,L,A,(0,r._)("a",G,[J,(0,r.Wm)(l)])])]),B,(0,r._)("ul",null,[(0,r._)("li",null,[(0,r._)("a",K,[X,(0,r.Wm)(l)])])])])}]])}}]);