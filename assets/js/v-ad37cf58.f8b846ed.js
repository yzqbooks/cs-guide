"use strict";(self.webpackChunkcs_guide=self.webpackChunkcs_guide||[]).push([[85034],{16977:(e,a,d)=>{d.r(a),d.d(a,{data:()=>t});const t=JSON.parse('{"key":"v-ad37cf58","path":"/frontend/tampermonkey/tamper-api.html","title":"tampermonkey相关的api","lang":"zh-CN","frontmatter":{"summary":"tampermonkey相关的api 文档见链接 用户脚本 Header @name 脚本名称 @namesapce 脚本命名空间 @include 设置脚本在哪些网页中可以运行，允许设置多个标签。 @include 不支持URL hash参数。 @match 与 @include 标签类似，允许设置多个。 @exclude 排除的URL， 在这些页面不运行","head":[["meta",{"property":"og:url","content":"https://yzqdev.github.io/cs-guide/cs-guide/frontend/tampermonkey/tamper-api.html"}],["meta",{"property":"og:site_name","content":"cs-guide"}],["meta",{"property":"og:title","content":"tampermonkey相关的api"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-04-10T12:33:03.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:modified_time","content":"2022-04-10T12:33:03.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"用户脚本 Header","slug":"用户脚本-header","children":[{"level":3,"title":"@name","slug":"name","children":[]},{"level":3,"title":"@namesapce","slug":"namesapce","children":[]},{"level":3,"title":"@include","slug":"include","children":[]},{"level":3,"title":"@match","slug":"match","children":[]},{"level":3,"title":"@exclude","slug":"exclude","children":[]},{"level":3,"title":"@require","slug":"require","children":[]},{"level":3,"title":"@resource","slug":"resource","children":[]},{"level":3,"title":"@connect","slug":"connect","children":[]},{"level":3,"title":"@run-at","slug":"run-at","children":[]},{"level":3,"title":"@grant","slug":"grant","children":[]}]},{"level":2,"title":"API","slug":"api","children":[{"level":3,"title":"unsafeWindow","slug":"unsafewindow","children":[]},{"level":3,"title":"Subresource Integrity","slug":"subresource-integrity","children":[]},{"level":3,"title":"GM_addStyle(css)","slug":"gm-addstyle-css","children":[]},{"level":3,"title":"GM_deleteValue(name)","slug":"gm-deletevalue-name","children":[]},{"level":3,"title":"GM_listValues()","slug":"gm-listvalues","children":[]},{"level":3,"title":"GM_addValueChangeListener(name, function(name, old_value, new_value, remote) {})","slug":"gm-addvaluechangelistener-name-function-name-old-value-new-value-remote","children":[]},{"level":3,"title":"GM_removeValueChangeListener(listener_id)","slug":"gm-removevaluechangelistener-listener-id","children":[]},{"level":3,"title":"GM_setValue(name, value)","slug":"gm-setvalue-name-value","children":[]},{"level":3,"title":"GM_getValue(name, defaultValue)","slug":"gm-getvalue-name-defaultvalue","children":[]},{"level":3,"title":"GM_log(message)","slug":"gm-log-message","children":[]},{"level":3,"title":"GM_getResourceText(name)","slug":"gm-getresourcetext-name","children":[]},{"level":3,"title":"GM_getResourceURL(name)","slug":"gm-getresourceurl-name","children":[]},{"level":3,"title":"GM_registerMenuCommand(name, fn, accessKey)","slug":"gm-registermenucommand-name-fn-accesskey","children":[]},{"level":3,"title":"GM_unregisterMenuCommand(menuCmdId)","slug":"gm-unregistermenucommand-menucmdid","children":[]},{"level":3,"title":"GM_openInTab(url, options), GM_openInTab(url, loadInBackground)","slug":"gm-openintab-url-options-gm-openintab-url-loadinbackground","children":[]},{"level":3,"title":"GM_xmlhttpRequest(details)","slug":"gm-xmlhttprequest-details","children":[]},{"level":3,"title":"GM_download(details), GM_download(url, name)","slug":"gm-download-details-gm-download-url-name","children":[]},{"level":3,"title":"GM_getTab(callback)","slug":"gm-gettab-callback","children":[]},{"level":3,"title":"GM_saveTab(tab)","slug":"gm-savetab-tab","children":[]},{"level":3,"title":"GM_getTabs(callback)","slug":"gm-gettabs-callback","children":[]},{"level":3,"title":"GM_notification(details, ondone) GM_notification(text, title, image, onlick)","slug":"gm-notification-details-ondone-gm-notification-text-title-image-onlick","children":[]},{"level":3,"title":"GM_setClipborad(data, info)","slug":"gm-setclipborad-data-info","children":[]},{"level":3,"title":"GM_info","slug":"gm-info","children":[]}]}],"git":{"createdTime":1647861419000,"updatedTime":1649593983000,"contributors":[{"name":"yzqdev","email":"yzqdev@outlook.com","commits":2}]},"readingTime":{"minutes":4.21,"words":1263},"filePathRelative":"frontend/tampermonkey/tamper-api.md","localizedDate":"2022年3月21日"}')},32744:(e,a,d)=>{d.r(a),d.d(a,{default:()=>m});var t=d(66252);const i=(0,t._)("h1",{id:"tampermonkey相关的api",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#tampermonkey相关的api","aria-hidden":"true"},"#"),(0,t.Uk)(" tampermonkey相关的api")],-1),n={class:"custom-container tip"},l=(0,t._)("p",{class:"custom-container-title"},"提示",-1),o=(0,t.Uk)("文档见"),c={href:"https://www.tampermonkey.net/documentation.php?ext=dhdg",target:"_blank",rel:"noopener noreferrer"},r=(0,t.Uk)("链接"),s=(0,t.uE)('<h2 id="用户脚本-header" tabindex="-1"><a class="header-anchor" href="#用户脚本-header" aria-hidden="true">#</a> 用户脚本 Header</h2><h3 id="name" tabindex="-1"><a class="header-anchor" href="#name" aria-hidden="true">#</a> <code>@name</code></h3><p>脚本名称</p><h3 id="namesapce" tabindex="-1"><a class="header-anchor" href="#namesapce" aria-hidden="true">#</a> <code>@namesapce</code></h3><p>脚本命名空间</p><h3 id="include" tabindex="-1"><a class="header-anchor" href="#include" aria-hidden="true">#</a> <code>@include</code></h3><p>设置脚本在哪些网页中可以运行，允许设置多个标签。 <code>@include</code> 不支持URL hash参数。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// @include http://123.com/*\n// @include https://123.com/*\n// @include https://*\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="match" tabindex="-1"><a class="header-anchor" href="#match" aria-hidden="true">#</a> <code>@match</code></h3><p>与 <code>@include</code> 标签类似，允许设置多个。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// @match http*://\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="exclude" tabindex="-1"><a class="header-anchor" href="#exclude" aria-hidden="true">#</a> <code>@exclude</code></h3><p>排除的URL， 在这些页面不运行脚本， 即使地址包含在 <code>@include</code>或<code>@match</code>标签内。允许设置多个。</p><h3 id="require" tabindex="-1"><a class="header-anchor" href="#require" aria-hidden="true">#</a> <code>@require</code></h3><p>表示在运行脚本前需要加载和运行的JavaScript文件。允许设置多个。 注：如果加载的脚本使用<code>use strict</code>模式，用户脚本可能也会受严格模式影响</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// @require https://code.jquery.com/jquery-2.1.4.min.js\n// @require https://code.jquery.com/jquery-2.1.3.min.js#sha256=23456...\n// @require https://code.jquery.com/jquery-2.1.2.min.js#md5=34567...,sha256=6789..\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="resource" tabindex="-1"><a class="header-anchor" href="#resource" aria-hidden="true">#</a> <code>@resource</code></h3><p>定义一些需要预加载的资源文件，这些资源可以在脚本中通过<code>GM_getResourceURL</code>，<code>GM_getResourceText</code>访问。允许设置多个。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// @resource icon2 /images/icon.png\n// @resource html http://www.tampermonkey.net/index.html\n// @resource xml http://www.tampermonkey.net/crx/tampermonkey.xml\n// @resource SRIsecured1 http://www.tampermonkey.net/favicon.ico#md5=123434...\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="connect" tabindex="-1"><a class="header-anchor" href="#connect" aria-hidden="true">#</a> <code>@connect</code></h3><p>设置允许通过<code>GM_xmlhttpRequest</code>连接访问的域名（包括子域名）。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// @connect *\n// @connect *://*.qidian.com/\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>@connect</code> 标签允许设置的值：</p><ul><li>域名，如<code>tampermonkey.net</code>, 设置后该域名下的所有子域名都是允许访问的</li><li>子域名，如<code>safari.tampermonkey.net</code></li><li><code>self</code> 当前脚本正在运行的域名</li><li><code>localhost</code></li><li><code>1.2.3.4</code> 允许连接的IP地址</li><li><code>*</code> 所有域名</li></ul><h3 id="run-at" tabindex="-1"><a class="header-anchor" href="#run-at" aria-hidden="true">#</a> <code>@run-at</code></h3><p>设置注入脚本的时间。<code>@run-at</code> defines the first possible moment a script wants to run.</p><ul><li><code>@run-at document-start</code> The script will be injected as fast as possible.</li><li><code>@run-at document-body</code> The script will be injected if the body element exists.</li><li><code>@run-at document-end</code> The script will be injected when or after the DOMContentLoaded event was dispatched.</li><li><code>@run-at document-idle</code> The script will be injected after the DOMContentLoaded event was dispatched. This is the default value if no @run-at tag is given.</li><li><code>@run-at content-menu</code> The script will be injected if it is clicked at the browser context menu (desktop Chrome-based browsers only).</li></ul><h3 id="grant" tabindex="-1"><a class="header-anchor" href="#grant" aria-hidden="true">#</a> <code>@grant</code></h3><p><code>@grant</code>标签用于设置<code>GM_*</code>方法， <code>unsafeWindow</code>对象， <code>window</code>对象方法的白名单。If no @grant tag is given TM guesses the scripts needs.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// @grant GM_setValue\n// @grant GM_getValue\n// @grant GM_setClipboard\n// @grant unsafeWindow\n// @grant window.close\n// @grant window.focus\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="api" tabindex="-1"><a class="header-anchor" href="#api" aria-hidden="true">#</a> API</h2><h3 id="unsafewindow" tabindex="-1"><a class="header-anchor" href="#unsafewindow" aria-hidden="true">#</a> <code>unsafeWindow</code></h3><p>通过<code>unsafeWindow</code>对象访问页面的js方法和变量</p><h3 id="subresource-integrity" tabindex="-1"><a class="header-anchor" href="#subresource-integrity" aria-hidden="true">#</a> <code>Subresource Integrity</code></h3><p><code>@require``@resource</code>标签设置URL的hash部分</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// @require https://code.jquery.com/jquery-2.1.1.min.js#md5=45eef...\n// @require https://code.jquery.com/jquery-2.1.2.min.js#md5=ac56d...,sha256=6e789.\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gm-addstyle-css" tabindex="-1"><a class="header-anchor" href="#gm-addstyle-css" aria-hidden="true">#</a> <code>GM_addStyle(css)</code></h3><p>Adds the given style to the document and returns the injected style element.</p><h3 id="gm-deletevalue-name" tabindex="-1"><a class="header-anchor" href="#gm-deletevalue-name" aria-hidden="true">#</a> <code>GM_deleteValue(name)</code></h3><p>Deletes &#39;name&#39; from storage.</p><h3 id="gm-listvalues" tabindex="-1"><a class="header-anchor" href="#gm-listvalues" aria-hidden="true">#</a> <code>GM_listValues()</code></h3><p>List all names of the storage.</p><h3 id="gm-addvaluechangelistener-name-function-name-old-value-new-value-remote" tabindex="-1"><a class="header-anchor" href="#gm-addvaluechangelistener-name-function-name-old-value-new-value-remote" aria-hidden="true">#</a> <code>GM_addValueChangeListener(name, function(name, old_value, new_value, remote) {})</code></h3><p>对storage存储的变量添加监听器，返回监听器ID。 <code>name</code>参数是要监听的变量名</p><h3 id="gm-removevaluechangelistener-listener-id" tabindex="-1"><a class="header-anchor" href="#gm-removevaluechangelistener-listener-id" aria-hidden="true">#</a> <code>GM_removeValueChangeListener(listener_id)</code></h3><p>移除监听器</p><h3 id="gm-setvalue-name-value" tabindex="-1"><a class="header-anchor" href="#gm-setvalue-name-value" aria-hidden="true">#</a> <code>GM_setValue(name, value)</code></h3><p>Set the value of &#39;name&#39; to the storage.</p><h3 id="gm-getvalue-name-defaultvalue" tabindex="-1"><a class="header-anchor" href="#gm-getvalue-name-defaultvalue" aria-hidden="true">#</a> <code>GM_getValue(name, defaultValue)</code></h3><p>从storage里面获取&#39;name&#39;的值</p><h3 id="gm-log-message" tabindex="-1"><a class="header-anchor" href="#gm-log-message" aria-hidden="true">#</a> <code>GM_log(message)</code></h3><p>控制台输出日志</p><h3 id="gm-getresourcetext-name" tabindex="-1"><a class="header-anchor" href="#gm-getresourcetext-name" aria-hidden="true">#</a> <code>GM_getResourceText(name)</code></h3><p>获取在脚本头部用<code>@resource</code>标签预定义的的内容</p><h3 id="gm-getresourceurl-name" tabindex="-1"><a class="header-anchor" href="#gm-getresourceurl-name" aria-hidden="true">#</a> <code>GM_getResourceURL(name)</code></h3><p>获取在脚本头部用<code>@resource</code>标签预定义的的base64编码的URI</p><h3 id="gm-registermenucommand-name-fn-accesskey" tabindex="-1"><a class="header-anchor" href="#gm-registermenucommand-name-fn-accesskey" aria-hidden="true">#</a> <code>GM_registerMenuCommand(name, fn, accessKey)</code></h3><p>在脚本运行页面的Tampermonkey菜单中注册新的菜单，返回菜单command ID</p><h3 id="gm-unregistermenucommand-menucmdid" tabindex="-1"><a class="header-anchor" href="#gm-unregistermenucommand-menucmdid" aria-hidden="true">#</a> <code>GM_unregisterMenuCommand(menuCmdId)</code></h3><p>注销用<code>GM_registerMenuCommand</code>注册的菜单</p><h3 id="gm-openintab-url-options-gm-openintab-url-loadinbackground" tabindex="-1"><a class="header-anchor" href="#gm-openintab-url-options-gm-openintab-url-loadinbackground" aria-hidden="true">#</a> <code>GM_openInTab(url, options), GM_openInTab(url, loadInBackground)</code></h3><p>在新标签页打开URL。<code>options</code>可选的值：</p><ul><li><code>active</code> 定义焦点是否在新标签页上</li><li><code>insert</code></li><li><code>setParent</code></li></ul><h3 id="gm-xmlhttprequest-details" tabindex="-1"><a class="header-anchor" href="#gm-xmlhttprequest-details" aria-hidden="true">#</a> <code>GM_xmlhttpRequest(details)</code></h3><p>Make an xmlHttpRequest.</p><h3 id="gm-download-details-gm-download-url-name" tabindex="-1"><a class="header-anchor" href="#gm-download-details-gm-download-url-name" aria-hidden="true">#</a> <code>GM_download(details), GM_download(url, name)</code></h3><p>下载URL指定资源到本地磁盘</p><p><code>details</code> 可以有如下属性:</p><ul><li><code>url</code> - 下载地址 (必需)</li><li><code>name</code> - 文件名 - 由于安全原因需要在Tampermonkey的配置页把文件扩展名设为白名单（<em>for security reasons the file extension needs to be whitelisted at Tampermonkey&#39;s options page</em>） (必需)</li><li><code>headers</code> - 参见 <code>GM_xmlhttpRequest</code></li><li><code>saveAs</code> - <code>boolean</code>, 弹出“保存为”的弹框</li><li><code>onerror</code> - 下载失败的回调</li><li><code>onload</code> - 下载完成回调</li><li><code>onprogress</code> 下载进度变化时的回调</li><li><code>ontimeout</code> 由于超时导致下载失败时的回调</li></ul><p><code>onerror</code> 回调函数的参数：</p><ul><li><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>error\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>- 失败原因</p><ul><li><code>not_enabled</code> - 用户不能使用下载功能</li><li><code>not_whitelisted</code> - 下载文件后缀不在白名单内</li><li><code>not_permitted</code> - the user enabled the download feature, but did not give the downloads permission</li><li><code>not_supported</code> - the download feature isn&#39;t supported by the browser/version</li><li><code>not_succeeded</code> - the download wasn&#39;t started or failed, the details attribute may provide more information</li></ul></li><li><p><code>details</code> 关于错误的详细信息</p></li></ul><p>下载扩展白名单设置如下：</p><p><img src="https://cdn.bianchengquan.com/4fac9ba115140ac4f1c22da82aa0bc7f/blog/5fd1a4eec3b9d.png" alt="img" loading="lazy"></p><blockquote><p>Chrome 可以使用 Tampermonkey 的 GM_download 函数绕过 CSP(Content Security Policy) 的限制</p></blockquote><h3 id="gm-gettab-callback" tabindex="-1"><a class="header-anchor" href="#gm-gettab-callback" aria-hidden="true">#</a> <code>GM_getTab(callback)</code></h3><p>Get a object that is persistent as long as this tab is open.</p><h3 id="gm-savetab-tab" tabindex="-1"><a class="header-anchor" href="#gm-savetab-tab" aria-hidden="true">#</a> <code>GM_saveTab(tab)</code></h3><p>Save the tab object to reopen it after a page unload.</p><h3 id="gm-gettabs-callback" tabindex="-1"><a class="header-anchor" href="#gm-gettabs-callback" aria-hidden="true">#</a> <code>GM_getTabs(callback)</code></h3><p>Get all tab objects as a hash to communicate with other script instances.</p><h3 id="gm-notification-details-ondone-gm-notification-text-title-image-onlick" tabindex="-1"><a class="header-anchor" href="#gm-notification-details-ondone-gm-notification-text-title-image-onlick" aria-hidden="true">#</a> <code>GM_notification(details, ondone)</code> <code>GM_notification(text, title, image, onlick)</code></h3><p>显示一个H5桌面通知，并/或 高亮显示当前Tab</p><p><code>details</code> 有如下特性:</p><ul><li><code>text</code> - 通知的文本 (需要 <code>highlight</code> 设置为<code>false</code>)</li><li><code>title</code> - 通知的标题</li><li><code>image</code> - 图片</li><li><code>highlight</code> - <code>boolean</code> 是否高亮发送通知的标签页 (未设置<code>text</code>时)</li><li><code>silent</code> - <code>boolean</code> 是否播放提示音</li><li><code>timeout</code> - <code>timeout</code> 设置的时间之后通知会被隐藏 (0 = disabled)</li><li><code>ondone</code> - 通知被关闭时调用 (no matter if this was triggered by a timeout or a click) or the tab was highlighted</li><li><code>onclick</code> - 用户点击通知时调用</li></ul><h3 id="gm-setclipborad-data-info" tabindex="-1"><a class="header-anchor" href="#gm-setclipborad-data-info" aria-hidden="true">#</a> <code>GM_setClipborad(data, info)</code></h3><p>复制内容到剪贴板，The parameter &#39;info&#39; can be an object like &quot;{ type: &#39;text&#39;, mimetype: &#39;text/plain&#39;}&quot; or just a string expressing the type (&quot;text&quot; or &quot;html&quot;)</p><h3 id="gm-info" tabindex="-1"><a class="header-anchor" href="#gm-info" aria-hidden="true">#</a> <code>GM_info</code></h3><p>获取关于脚本和GM的一些信息</p>',88),u={},m=(0,d(83744).Z)(u,[["render",function(e,a){const d=(0,t.up)("ExternalLinkIcon");return(0,t.wg)(),(0,t.iD)("div",null,[i,(0,t._)("div",n,[l,(0,t._)("p",null,[o,(0,t._)("a",c,[r,(0,t.Wm)(d)])])]),s])}]])}}]);