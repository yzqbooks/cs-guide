"use strict";(self.webpackChunkcs_guide=self.webpackChunkcs_guide||[]).push([[318],{91624:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e=JSON.parse('{"key":"v-f13ccf70","path":"/linux-tutor/configs/nginx.html","title":"nginx配置","lang":"zh-CN","frontmatter":{"summary":"nginx配置 nginx命令行 @code shell 检测nginix @code shell nginx 配置 @code conf","head":[["meta",{"property":"og:url","content":"https://yzqdev.github.io/cs-guide/cs-guide/linux-tutor/configs/nginx.html"}],["meta",{"property":"og:site_name","content":"cs-guide"}],["meta",{"property":"og:title","content":"nginx配置"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-05-26T11:39:36.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:modified_time","content":"2022-05-26T11:39:36.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"nginx命令行","slug":"nginx命令行","children":[]},{"level":2,"title":"检测nginix","slug":"检测nginix","children":[]},{"level":2,"title":"nginx 配置","slug":"nginx-配置","children":[]}],"git":{"createdTime":1653565176000,"updatedTime":1653565176000,"contributors":[{"name":"yzqdev","email":"yzqdev@outlook.com","commits":1}]},"readingTime":{"minutes":0.1,"words":29},"filePathRelative":"linux-tutor/configs/nginx.md","localizedDate":"2022年5月26日"}')},37310:(n,s,a)=>{a.r(s),a.d(s,{default:()=>t});var e=a(66252);const i=[(0,e.uE)('<h1 id="nginx配置" tabindex="-1"><a class="header-anchor" href="#nginx配置" aria-hidden="true">#</a> nginx配置</h1><h2 id="nginx命令行" tabindex="-1"><a class="header-anchor" href="#nginx命令行" aria-hidden="true">#</a> nginx命令行</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>\n\n\n<span class="token comment">#nginx执行程序路径需要修改</span>\n<span class="token assign-left variable">nginxd</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx\n\n<span class="token comment"># nginx配置文件路径需要修改</span>\n<span class="token assign-left variable">nginx_config</span><span class="token operator">=</span>/usr/local/nginx/conf/nginx.conf\n\n<span class="token comment"># pid 地址需要修改</span>\n<span class="token assign-left variable">nginx_pid</span><span class="token operator">=</span>/var/local/nginx/nginx.pid\n\n\n<span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token number">0</span>\n<span class="token assign-left variable">prog</span><span class="token operator">=</span><span class="token string">&quot;nginx&quot;</span>\n\n<span class="token comment"># Source function library.</span>\n<span class="token builtin class-name">.</span> /etc/rc.d/init.d/functions\n<span class="token comment"># Source networking configuration.</span>\n<span class="token builtin class-name">.</span> /etc/sysconfig/network\n<span class="token comment"># Check that networking is up.</span>\n<span class="token punctuation">[</span> <span class="token variable">${NETWORKING}</span> <span class="token operator">=</span> <span class="token string">&quot;no&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span>\n<span class="token punctuation">[</span> -x <span class="token variable">$nginxd</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span>\n\n<span class="token comment"># Start nginx daemons functions.</span>\n<span class="token function-name function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">if</span> <span class="token punctuation">[</span> -e <span class="token variable">$nginx_pid</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>\n   <span class="token builtin class-name">echo</span> <span class="token string">&quot;nginx already running....&quot;</span>\n   <span class="token builtin class-name">exit</span> <span class="token number">1</span>\n<span class="token keyword">fi</span>\n\n<span class="token builtin class-name">echo</span> -n $<span class="token string">&quot;Starting <span class="token variable">$prog</span>: &quot;</span>\ndaemon <span class="token variable">$nginxd</span> -c <span class="token variable">${nginx_config}</span>\n<span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token variable">$?</span>\n<span class="token builtin class-name">echo</span>\n<span class="token punctuation">[</span> <span class="token variable">$RETVAL</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">touch</span> /var/lock/subsys/nginx\n<span class="token builtin class-name">return</span> <span class="token variable">$RETVAL</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment"># Stop nginx daemons functions.</span>\n<span class="token comment"># pid 地址需要修改</span>\n<span class="token function-name function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token builtin class-name">echo</span> -n $<span class="token string">&quot;Stopping <span class="token variable">$prog</span>: &quot;</span>\n    killproc <span class="token variable">$nginxd</span>\n    <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token variable">$?</span>\n    <span class="token builtin class-name">echo</span>\n    <span class="token punctuation">[</span> <span class="token variable">$RETVAL</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -f /var/lock/subsys/nginx /var/local/nginx/nginx.pid\n<span class="token punctuation">}</span>\n\n<span class="token comment"># reload nginx service functions.</span>\n<span class="token function-name function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token builtin class-name">echo</span> -n $<span class="token string">&quot;Reloading <span class="token variable">$prog</span>: &quot;</span>\n    <span class="token comment">#kill -HUP `cat ${nginx_pid}`</span>\n    killproc <span class="token variable">$nginxd</span> -HUP\n    <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token variable">$?</span>\n    <span class="token builtin class-name">echo</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment"># See how we were called.</span>\n<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token keyword">in</span>\n    start<span class="token punctuation">)</span>\n        start\n        <span class="token punctuation">;</span><span class="token punctuation">;</span>\n    stop<span class="token punctuation">)</span>\n        stop\n        <span class="token punctuation">;</span><span class="token punctuation">;</span>\n    reload<span class="token punctuation">)</span>\n        reload\n        <span class="token punctuation">;</span><span class="token punctuation">;</span>\n    restart<span class="token punctuation">)</span>\n        stop\n        start\n        <span class="token punctuation">;</span><span class="token punctuation">;</span>\n    status<span class="token punctuation">)</span>\n        status <span class="token variable">$prog</span>\n        <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token variable">$?</span>\n        <span class="token punctuation">;</span><span class="token punctuation">;</span>\n    *<span class="token punctuation">)</span>\n\n    <span class="token builtin class-name">echo</span> $<span class="token string">&quot;Usage: <span class="token variable">$prog</span> {start|stop|restart|reload|status|help}&quot;</span>\n    <span class="token builtin class-name">exit</span> <span class="token number">1</span>\n\n<span class="token keyword">esac</span>\n<span class="token builtin class-name">exit</span> <span class="token variable">$RETVAL</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="检测nginix" tabindex="-1"><a class="header-anchor" href="#检测nginix" aria-hidden="true">#</a> 检测nginix</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>\n<span class="token comment"># 如果进程中没有nginx则将keepalived进程kill掉</span>\n<span class="token assign-left variable">A</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> -C nginx --no-header <span class="token operator">|</span><span class="token function">wc</span> -l<span class="token variable">`</span></span>      <span class="token comment">## 查看是否有 nginx进程 把值赋给变量A </span>\n<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$A</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>                    <span class="token comment">## 如果没有进程值得为 零</span>\n       <span class="token function">service</span> keepalived stop          <span class="token comment">## 则结束 keepalived 进程</span>\n<span class="token keyword">fi</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nginx-配置" tabindex="-1"><a class="header-anchor" href="#nginx-配置" aria-hidden="true">#</a> nginx 配置</h2><div class="language-conf ext-conf line-numbers-mode"><pre class="language-conf"><code>user root;\nworker_processes  auto;\npid /run/nginx.pid;\n\nevents {\n    use epoll;\n    multi_accept on;\n    worker_connections  1024;\n}\n\nhttp {\n    # 必须加这两个，不然 CSS 无法正常加载\n    include mime.types;\n    default_type application/octet-stream;\n\n    sendfile            on;\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    keepalive_timeout   65;\n    types_hash_max_size 2048;\n\n    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;\n                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;\n                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; &quot;$request_time&quot;&#39;;\n\n    access_log /var/log/nginx/access.log main;\n    error_log /var/log/nginx/error.log;\n\n    gzip on;\n    gzip_buffers 8 16k;\n    gzip_min_length 512;\n    gzip_disable &quot;MSIE [1-6]\\.(?!.*SV1)&quot;;\n    gzip_http_version 1.1;\n    gzip_types   text/plain text/css application/javascript application/x-javascript application/json application/xml;\n\n    server {\n\n        listen       8001;\n        server_name  localhost 127.0.0.1 139.159.190.24 platform.gitnavi.com;\n\n        location / {\n            root /root/.jenkins/workspace/nestle-platform-front-test/dist;\n            index index.html index.htm;\n            try_files $uri /index.html;\n        }\n\n        ## 二级目录方式，记得 package.json 添加：&quot;homepage&quot;: &quot;cdk8s-markdown&quot;,\n        location ^~ /cdk8s-markdown {\n            root    /root/.jenkins/workspace;\n            index   index.html;\n            try_files $uri /cdk8s-markdown/index.html;\n        }\n\n        location ^~ /platform/ {\n            proxy_pass http://127.0.0.1:28081;\n            proxy_redirect off;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n\n        location ~ .*\\.(js|css)?$ {\n            root   /root/.jenkins/workspace/nestle-platform-front-test/dist;\n        }\n\n        location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|ico|woff|woff2|ttf|eot|txt|svg)$ {\n            root   /root/.jenkins/workspace/nestle-platform-front-test/dist;\n        }\n\n        error_page 404 /404.html;\n           location = /usr/share/nginx/html/40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n           location = /usr/share/nginx/html/50x.html {\n        }\n\n    }\n\n    server {\n\n        listen       8002;\n        server_name  localhost 127.0.0.1 139.159.190.24 store.gitnavi.com;\n\n        location / {\n            root /root/.jenkins/workspace/nestle-store-front-test/dist;\n            index index.html index.htm;\n            try_files $uri /index.html;\n        }\n\n        location ^~ /store/ {\n            proxy_pass http://127.0.0.1:28082;\n            proxy_redirect off;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n\n        location ~ .*\\.(js|css)?$ {\n            root   /root/.jenkins/workspace/nestle-store-front-test/dist;\n        }\n\n        location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|ico|woff|woff2|ttf|eot|txt|svg)$ {\n            root   /root/.jenkins/workspace/nestle-store-front-test/dist;\n        }\n\n        error_page 404 /404.html;\n           location = /usr/share/nginx/html/40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n           location = /usr/share/nginx/html/50x.html {\n        }\n\n    }\n}\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',7)],l={},t=(0,a(83744).Z)(l,[["render",function(n,s){return(0,e.wg)(),(0,e.iD)("div",null,i)}]])}}]);